
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>doltpy.sql.sync package &#8212; Doltpy Documentation (0.1.x)</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/werkzeug.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = './';</script>
   
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Doltpy Documentation (0.1.x)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">doltpy.sql.sync package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="doltpy-sql-sync-package">
<h1>doltpy.sql.sync package<a class="headerlink" href="#doltpy-sql-sync-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-doltpy.sql.sync.db_tools">
<span id="doltpy-sql-sync-db-tools-module"></span><h2>doltpy.sql.sync.db_tools module<a class="headerlink" href="#module-doltpy.sql.sync.db_tools" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="doltpy.sql.sync.db_tools.build_source_reader">
<code class="sig-prename descclassname">doltpy.sql.sync.db_tools.</code><code class="sig-name descname">build_source_reader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">reader</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>sqlalchemy.engine.base.Engine<span class="p">, </span>sqlalchemy.sql.schema.Table<span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.db_tools.build_source_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a connection and a reader provides a function that turns a set of tables in to a data structure containing
the contents of each of the tables.
:param engine:
:param reader:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.db_tools.drop_primary_keys">
<code class="sig-prename descclassname">doltpy.sql.sync.db_tools.</code><code class="sig-name descname">drop_primary_keys</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">pks_to_drop</span><span class="p">:</span> <span class="n">Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.db_tools.drop_primary_keys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.db_tools.get_source_reader">
<code class="sig-prename descclassname">doltpy.sql.sync.db_tools.</code><code class="sig-name descname">get_source_reader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">reader</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>sqlalchemy.engine.base.Engine<span class="p">, </span>sqlalchemy.sql.schema.Table<span class="p">]</span><span class="p">, </span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.db_tools.get_source_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a connection and a reader provides a function that turns a set of tables in to a data structure containing
the contents of each of the tables.
:param engine:
:param reader:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.db_tools.get_table_metadata">
<code class="sig-prename descclassname">doltpy.sql.sync.db_tools.</code><code class="sig-name descname">get_table_metadata</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">table_name</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></span></em><span class="sig-paren">)</span> &#x2192; sqlalchemy.sql.schema.Table<a class="headerlink" href="#doltpy.sql.sync.db_tools.get_table_metadata" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.db_tools.get_table_reader">
<code class="sig-prename descclassname">doltpy.sql.sync.db_tools.</code><code class="sig-name descname">get_table_reader</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>sqlalchemy.engine.base.Engine<span class="p">, </span>sqlalchemy.sql.schema.Table<span class="p">]</span><span class="p">, </span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.db_tools.get_table_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>When syncing from a relational database, currently  MySQL or Postgres, the database has only a single concept of
state, that is the current state. We simply capture this state by reading out all the data in the database.
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.db_tools.get_target_writer_helper">
<code class="sig-prename descclassname">doltpy.sql.sync.db_tools.</code><code class="sig-name descname">get_target_writer_helper</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">get_upsert_statement</span></em>, <em class="sig-param"><span class="n">update_on_duplicate</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></span></em>, <em class="sig-param"><span class="n">clean_types</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Callable<span class="p">[</span><span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.db_tools.get_target_writer_helper" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a database connection returns a function that when passed a mapping from table names to TableUpdate will
apply the table update. A table update consists of primary key values to drop, and data to insert/update.
:param engine: a database connection
:param get_upsert_statement:
:param update_on_duplicate: indicates whether to update values when encountering duplicate PK, default True
:param clean_types: an optional function to clean up the types being written
:return:</p>
</dd></dl>

</div>
<div class="section" id="module-doltpy.sql.sync.dolt">
<span id="doltpy-sql-sync-dolt-module"></span><h2>doltpy.sql.sync.dolt module<a class="headerlink" href="#module-doltpy.sql.sync.dolt" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="doltpy.sql.sync.dolt.drop_missing_pks">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">drop_missing_pks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.dolt.drop_missing_pks" title="Permalink to this definition">¶</a></dt>
<dd><p>This a very basic n-squared implementation for dropping the primary keys present in Dolt that have been dropped in
the target database.
:param engine:
:param table:
:param data:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.dolt.get_dropped_pks">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">get_dropped_pks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">from_commit</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></span></em>, <em class="sig-param"><span class="n">to_commit</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></span></em><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.dolt.get_dropped_pks" title="Permalink to this definition">¶</a></dt>
<dd><p>Given table_metadata, a connection, and a pair of commits, will return the list of pks that were dropped between
the two commits.
:param engine:
:param table:
:param from_commit:
:param to_commit:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.dolt.get_from_commit_to_commit">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">get_from_commit_to_commit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dsc</span><span class="p">:</span> <span class="n"><a class="reference internal" href="doltpy.sql.html#doltpy.sql.sql.DoltSQLContext" title="doltpy.sql.sql.DoltSQLContext">doltpy.sql.sql.DoltSQLContext</a></span></em>, <em class="sig-param"><span class="n">commit_ref</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.dolt.get_from_commit_to_commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a repo and commit it returns the commit and its parent, if no commit is provided the head and the parent of
head are returned.
:param dsc:
:param commit_ref:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.dolt.get_source_reader">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">get_source_reader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dsc</span><span class="p">:</span> <span class="n"><a class="reference internal" href="doltpy.sql.html#doltpy.sql.sql.DoltSQLContext" title="doltpy.sql.sql.DoltSQLContext">doltpy.sql.sql.DoltSQLContext</a></span></em>, <em class="sig-param"><span class="n">reader</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference internal" href="doltpy.sql.html#doltpy.sql.sql.DoltSQLContext" title="doltpy.sql.sql.DoltSQLContext">doltpy.sql.sql.DoltSQLContext</a><span class="p">]</span><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.dolt.get_source_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a function that takes a list of tables and returns a mapping from the table name to the data returned by
the passed reader. The reader is generally one of <cite>get_table_reader_diffs</cite> or <cite>get_table_reader</cite>, but it would
be easy enough to provide some other kind of function if neither of these meet your needs.
:param dsc:
:param reader:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.dolt.get_table_reader">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">get_table_reader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">commit_ref</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">branch</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference internal" href="doltpy.sql.html#doltpy.sql.sql.DoltSQLContext" title="doltpy.sql.sql.DoltSQLContext">doltpy.sql.sql.DoltSQLContext</a><span class="p">]</span><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.dolt.get_table_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a function that reads the entire table at a commit and/or branch, and returns the data.
:param commit_ref:
:param branch:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.dolt.get_table_reader_diffs">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">get_table_reader_diffs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">commit_ref</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">branch</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference internal" href="doltpy.sql.html#doltpy.sql.sql.DoltSQLContext" title="doltpy.sql.sql.DoltSQLContext">doltpy.sql.sql.DoltSQLContext</a><span class="p">]</span><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.dolt.get_table_reader_diffs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a function that reads the diff from a commit and/or branch, defaults to the HEAD of the current branch if
neither are provided.
:param commit_ref:
:param branch:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.dolt.get_target_writer">
<code class="sig-prename descclassname">doltpy.sql.sync.dolt.</code><code class="sig-name descname">get_target_writer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dsc</span><span class="p">:</span> <span class="n"><a class="reference internal" href="doltpy.sql.html#doltpy.sql.sql.DoltSQLContext" title="doltpy.sql.sql.DoltSQLContext">doltpy.sql.sql.DoltSQLContext</a></span></em>, <em class="sig-param"><span class="n">branch</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">commit</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></span> <span class="o">=</span> <span class="default_value">True</span></em>, <em class="sig-param"><span class="n">message</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.dolt.get_target_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a repo, writes to the specified branch (defaults to current), and optionally commits with the provided
message or generates a standard one.
:param dssc:
:param branch:
:param commit:
:param message:
:return:</p>
</dd></dl>

</div>
<div class="section" id="module-doltpy.sql.sync.mysql">
<span id="doltpy-sql-sync-mysql-module"></span><h2>doltpy.sql.sync.mysql module<a class="headerlink" href="#module-doltpy.sql.sync.mysql" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="doltpy.sql.sync.mysql.get_target_writer">
<code class="sig-prename descclassname">doltpy.sql.sync.mysql.</code><code class="sig-name descname">get_target_writer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">update_on_duplicate</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.mysql.get_target_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a database connection returns a function that when passed a mapping from table names to TableUpdate will
apply the table update. A table update consists of primary key values to drop, and data to insert/update.
:param engine: a database connection
:param update_on_duplicate: indicates whether to update values when encountering duplicate PK, default True
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.mysql.upsert_helper">
<code class="sig-prename descclassname">doltpy.sql.sync.mysql.</code><code class="sig-name descname">upsert_helper</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.mysql.upsert_helper" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-doltpy.sql.sync.oracle">
<span id="doltpy-sql-sync-oracle-module"></span><h2>doltpy.sql.sync.oracle module<a class="headerlink" href="#module-doltpy.sql.sync.oracle" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="doltpy.sql.sync.oracle.execute_updates_and_inserts">
<code class="sig-prename descclassname">doltpy.sql.sync.oracle.</code><code class="sig-name descname">execute_updates_and_inserts</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">update_on_duplicate</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.oracle.execute_updates_and_inserts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.oracle.get_target_writer">
<code class="sig-prename descclassname">doltpy.sql.sync.oracle.</code><code class="sig-name descname">get_target_writer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">update_on_duplicate</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.oracle.get_target_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a database connection returns a function that when passed a mapping from table names to TableUpdate will
apply the table update. A table update consists of primary key values to drop, and data to insert/update.
:param engine: a database connection
:param update_on_duplicate: indicates whether to update values when encountering duplicate PK, default True
:return:</p>
</dd></dl>

</div>
<div class="section" id="module-doltpy.sql.sync.postgres">
<span id="doltpy-sql-sync-postgres-module"></span><h2>doltpy.sql.sync.postgres module<a class="headerlink" href="#module-doltpy.sql.sync.postgres" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="doltpy.sql.sync.postgres.get_target_writer">
<code class="sig-prename descclassname">doltpy.sql.sync.postgres.</code><code class="sig-name descname">get_target_writer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">update_on_duplicate</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span><a class="headerlink" href="#doltpy.sql.sync.postgres.get_target_writer" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a psycopg2 connection returns a function that takes a map of tables names (optionally schema prefixed) to
list of tuples and writes the list of tuples to the table in question. Each tuple must have the data in the order of
the target tables columns sorted lexicographically.
:param engine: database connection.
:param update_on_duplicate: perform upserts instead of failing on duplicate primary keys
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.postgres.upsert_helper">
<code class="sig-prename descclassname">doltpy.sql.sync.postgres.</code><code class="sig-name descname">upsert_helper</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.postgres.upsert_helper" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-doltpy.sql.sync.sync_tools">
<span id="doltpy-sql-sync-sync-tools-module"></span><h2>doltpy.sql.sync.sync_tools module<a class="headerlink" href="#module-doltpy.sql.sync.sync_tools" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="doltpy.sql.sync.sync_tools.coerce_column_to_dolt">
<code class="sig-prename descclassname">doltpy.sql.sync.sync_tools.</code><code class="sig-name descname">coerce_column_to_dolt</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">column</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Column</span></em>, <em class="sig-param"><span class="n">type_mapping</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.sync_tools.coerce_column_to_dolt" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines how we map MySQL types to Dolt types, and removes unsupported column level constraints. Eventually this
function should be trivial since we aim to faithfully support MySQL.
:param column:
:param type_mapping:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.sync_tools.coerce_schema_to_dolt">
<code class="sig-prename descclassname">doltpy.sql.sync.sync_tools.</code><code class="sig-name descname">coerce_schema_to_dolt</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target_table_name</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a></span></em>, <em class="sig-param"><span class="n">table</span><span class="p">:</span> <span class="n">sqlalchemy.sql.schema.Table</span></em>, <em class="sig-param"><span class="n">type_mapping</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></span></em><span class="sig-paren">)</span> &#x2192; sqlalchemy.sql.schema.Table<a class="headerlink" href="#doltpy.sql.sync.sync_tools.coerce_schema_to_dolt" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.sync_tools.sync_from_dolt">
<code class="sig-prename descclassname">doltpy.sql.sync.sync_tools.</code><code class="sig-name descname">sync_from_dolt</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">source_reader</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">target_writer</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Tuple<span class="p">[</span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">table_map</span><span class="p">:</span> <span class="n">Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.sync_tools.sync_from_dolt" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a sync from Dolt to another database (currently only MySQL). Works by taking source_reader that reads from
Dolt. Various implementations are provided in doltpy.etl.sql_sync.dolt that offer different semantics. For example,
one might want to choose whether to sync the state of table at HEAD of master, or take only incremental diffs.
The writer implementations are more straightforward, and found in doltpy.etl.sql_sync.mysql. They offer the user the
ability to configure what to do on primary key duplicates.</p>
<p>Of course one can easily implement their own reads and writers, as they conform to the relevant type interfaces at
the top of the file.
:param source_reader:
:param target_writer:
:param table_map:
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.sync_tools.sync_schema_to_dolt">
<code class="sig-prename descclassname">doltpy.sql.sync.sync_tools.</code><code class="sig-name descname">sync_schema_to_dolt</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">source_engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">target_engine</span><span class="p">:</span> <span class="n">sqlalchemy.engine.base.Engine</span></em>, <em class="sig-param"><span class="n">table_map</span><span class="p">:</span> <span class="n">Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">type_mapping</span><span class="p">:</span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.sync_tools.sync_schema_to_dolt" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>source_engine</strong> – </p></li>
<li><p><strong>target_engine</strong> – </p></li>
<li><p><strong>table_map</strong> – </p></li>
<li><p><strong>type_mapping</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="doltpy.sql.sync.sync_tools.sync_to_dolt">
<code class="sig-prename descclassname">doltpy.sql.sync.sync_tools.</code><code class="sig-name descname">sync_to_dolt</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">source_reader</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>List<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">target_writer</span><span class="p">:</span> <span class="n">Callable<span class="p">[</span><span class="p">[</span>Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span>Iterable<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)">None</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">table_map</span><span class="p">:</span> <span class="n">Mapping<span class="p">[</span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">, </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)">str</a><span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#doltpy.sql.sync.sync_tools.sync_to_dolt" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a sync from another database (currently on MySQL) to Dolt. Since generally other databases have a single
notion of state, we merely seek to capture that notion of state. The source_reader function in
doltpy.etl.sql_sync.mysql captures the state of the table, and then the target_writer in doltpy.etl.sql_sync.dolt
merely writes that data to a commit.</p>
<p>One could imagine a more complex implementation were the source_reader captures only rows that have updated_at
field that is greater than the last sync timestamp. They would be easy enough to implement and we will provide
examples in future documentation.
:param source_reader:
:param target_writer:
:param table_map:
:return:</p>
</dd></dl>

</div>
<div class="section" id="module-doltpy.sql.sync">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-doltpy.sql.sync" title="Permalink to this headline">¶</a></h2>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
  

  <h3>Contents</h3>
  <ul>
<li><a class="reference internal" href="#">doltpy.sql.sync package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync.db_tools">doltpy.sql.sync.db_tools module</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync.dolt">doltpy.sql.sync.dolt module</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync.mysql">doltpy.sql.sync.mysql module</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync.oracle">doltpy.sql.sync.oracle module</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync.postgres">doltpy.sql.sync.postgres module</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync.sync_tools">doltpy.sql.sync.sync_tools module</a></li>
<li><a class="reference internal" href="#module-doltpy.sql.sync">Module contents</a></li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
  <li><a href="index.html">Overview</a>
    
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  <script src="_static/version_warning_offset.js"></script>

  </body>
</html>